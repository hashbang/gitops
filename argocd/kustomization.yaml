apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd
resources:
  - github.com/argoproj/argo-cd/manifests/cluster-install?ref=ac8b7df9467ffcc0920b826c62c4b603a7bfed24 # tag=v2.3.4
  - github.com/argoproj-labs/applicationset/manifests/namespace-install?ref=8100e6bf539029a39ebeb9d8094fc3885afa36d7 # v0.1.0
  - ingress.yaml
  - argo-cd-service-monitor.yaml
  - argocd-notifications/
  - deploy-key.yaml
  # Projects
  - projects/default.yaml
  # Applications to deploy
  - applications/argocd.yaml
  - applications/book.yaml
  - applications/cert-manager.yaml
  - applications/cert-manager-issuers.yaml
  - applications/external-dns.yaml
  - applications/ingress-nginx.yaml
  - applications/ircd.yaml
  - applications/matterbridge.yaml
  - applications/monitoring.yaml
  - applications/mtls.yaml
  - applications/site.yaml
  - applications/userdb-api.yaml
  - applications/webirc.yaml
patches:
  - argo-cd-repo-server-ksops.patch.yaml
  - argo-cd-allow-alpha-plugins.patch.yaml
  - argo-cd-import-pgp-key.patch.yaml
  - argo-cd-repository-credentials.patch.yaml
  - argo-cd-rbac.patch.yaml
  - argo-cd-allow-status-badges.patch.yaml
  - users.patch.yaml
configMapGenerator:
  - name: grafana-dashboard
    options:
      disableNameSuffixHash: true
      labels:
        grafana_dashboard: "1"
    files:
      # From https://github.com/argoproj/argo-cd/blob/master/examples/dashboard.json
      - files/grafana-dashboard-argocd.json
      # From https://argoproj-labs.github.io/argocd-notifications/grafana-dashboard.json
      - files/grafana-dashboard-argocd-notifications.json
  - name: argocd-gpg-keys-cm
    behavior: merge
    options:
      disableNameSuffixHash: true
    files:
      - gpg-keys/C91A9911192C187A
      - gpg-keys/6785F7AF28DE7081
      - gpg-keys/E90A401336C8AAA9
      - gpg-keys/68907D8BCCD85A5A
      - gpg-keys/B10116B8193F2DBD
      - gpg-keys/26CDD32189AA2885
images:
  - name: quay.io/argoproj/argocd:v2.3.4
    digest: sha256:e4a175d16f7714228d0fb4addb34f3aae5c2e5b905d489170617a0e69c06d9ae
  - name: quay.io/argocdapplicationset/argocd-applicationset:v0.1.0
    digest: sha256:bd62ff6ee18f16e9021ae89e347cd6ded960d6054bdd3c608fc05acdf8a03bc3
  - name: ghcr.io/dexidp/dex:v2.30.2
    digest: sha256:27cf2e8644f2ea1ebc6de711b0ace4b5ee2d1f442e148eabbaa8c68308062475
  - name: redis:7.0.0-alpine
    digest: sha256:a22bc2d15940ae67680611827b3e9b69150d7c11c063415c3775c35d163bb555
  - name: viaductoss/ksops:v2.3.4
    digest: sha256:75759f2927eaf64f214a55952b312243eb83ec0b8bebb4753e2bc7f346fc7088
generators:
  - secret-generator.yaml
replicas:
- name: argocd-server
  count: 2

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd
resources:
  - github.com/argoproj/argo-cd/manifests/cluster-install?ref=cbee7e6011407ed2d1066c482db74e97e0cc6bdb # tag=v2.7.2
  - ingress.yaml
  - argo-cd-service-monitor.yaml
  - deploy-key.yaml
  # Projects
  - projects/default.yaml
  # Applications to deploy
  - applicationset-generator.yaml
patches:
  - path: argocd-notifications-cm.patch.yaml
  - path: argo-cd-repo-server-ksops.patch.yaml
  - path: argo-cd-allow-alpha-plugins.patch.yaml
  - path: argo-cd-import-pgp-key.patch.yaml
  - path: argo-cd-repository-credentials.patch.yaml
  - path: argo-cd-rbac.patch.yaml
  - path: argo-cd-allow-status-badges.patch.yaml
  - path: users.patch.yaml
configMapGenerator:
  - name: argocd-cm
    behavior: merge
    literals:
      # https://argo-cd.readthedocs.io/en/stable/user-guide/resource_tracking/#additional-tracking-methods-via-an-annotation
      - application.resourceTrackingMethod=annotation+label
  - name: grafana-dashboard
    options:
      disableNameSuffixHash: true
      labels:
        grafana_dashboard: "1"
    files:
      # From https://github.com/argoproj/argo-cd/blob/master/examples/dashboard.json
      - files/grafana-dashboard-argocd.json
      # From https://argoproj-labs.github.io/argocd-notifications/grafana-dashboard.json
      - files/grafana-dashboard-argocd-notifications.json
  - name: argocd-gpg-keys-cm
    behavior: merge
    options:
      disableNameSuffixHash: true
    files:
      - gpg-keys/C91A9911192C187A  # daurnimator
      - gpg-keys/6785F7AF28DE7081  # Ryan Heywood
      - gpg-keys/E90A401336C8AAA9  # Lance R. Vick
      - gpg-keys/68907D8BCCD85A5A  # Ben Harris
      - gpg-keys/B10116B8193F2DBD  # Daniel Grove
      - gpg-keys/26CDD32189AA2885  # David Pflug
      - gpg-keys/E6A270B1A4DA649A  # kellerfuchs
images:
  - name: quay.io/argoproj/argocd
    newTag: v2.7.2@sha256:9b867d3175815d6d253dbc817bb7da34a3ba49a99ffade9a36cad238cf78963e
  - name: ghcr.io/dexidp/dex
    newTag: v2.36.0-distroless@sha256:35146b7ab0552f73fa5f9b4eaa71059ce44345d96e465c840c21b2b71a701239
  - name: redis
    newTag: 7.0.11-alpine@sha256:1f27b9eb680ffcf6c68966c0d5f578bb1b030ca7cd8ec4e758c429e7f72005a0
  - name: viaductoss/ksops
    newTag: v4.1.1@sha256:1707bd0f84124680cb17927f13b3b1c34f6aa9f07e0a6a6705980aaab75995f4
generators:
  - secret-generator.yaml
replicas:
- name: argocd-server
  count: 2
